{% extends 'base.html' %}
{% block title %}My Profile{% endblock %}
{% block content %}
<div class="container py-4" style="max-width:650px">
  <h2 class="fw-bold mb-4">ğŸ‘¤ Edit Profile</h2>

  <div class="card border-0 shadow-sm" style="border-radius:16px">
    <div class="card-body p-4">
      <!-- Avatar -->
      <div class="text-center mb-4">
        <div class="position-relative d-inline-block" onclick="document.getElementById('avatarInput').click()" style="cursor:pointer">
          <img id="avatarPreview"
               src="https://ui-avatars.com/api/?name={{ current_user.full_name or current_user.username }}&background=2e7d32&color=fff&size=100"
               class="rounded-circle" width="100" height="100" style="object-fit:cover;border:3px solid #4caf50"/>
          <div style="position:absolute;bottom:0;right:0;background:#2e7d32;color:white;border-radius:50%;
                      width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:0.7rem">
            <i class="fas fa-camera"></i>
          </div>
        </div>
        <input type="file" id="avatarInput" accept="image/*" class="d-none" onchange="previewAvatar(this)"/>
        <div class="mt-2">
          <span class="badge {{ 'bg-success' if current_user.is_farmer else 'bg-primary' }} px-3 py-2">
            {{ 'ğŸ‘¨â€ğŸŒ¾ Farmer' if current_user.is_farmer else 'ğŸ›’ Buyer' }}
          </span>
        </div>
      </div>

      <form method="POST" enctype="multipart/form-data">
        <input type="file" name="profile_image" id="profileImageInput" class="d-none"/>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="fw-semibold small">Full Name</label>
            <input type="text" class="form-control" name="full_name" value="{{ current_user.full_name or '' }}" placeholder="Your full name"/>
          </div>
          <div class="col-md-6">
            <label class="fw-semibold small">Username</label>
            <input type="text" class="form-control" value="{{ current_user.username }}" disabled/>
          </div>
          <div class="col-md-6">
            <label class="fw-semibold small">Email</label>
            <input type="email" class="form-control" value="{{ current_user.email }}" disabled/>
          </div>
          <div class="col-md-6">
            <label class="fw-semibold small">Phone Number</label>
            <input type="tel" class="form-control" name="phone" value="{{ current_user.phone or '' }}" placeholder="09XXXXXXXXX"/>
          </div>
          <div class="col-md-6">
            <label class="fw-semibold small">Region</label>
            <select class="form-select" name="region">
              <option value="">Select region...</option>
              {% for region in regions %}
              <option value="{{ region }}" {{ 'selected' if region == current_user.region }}>{{ region }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col-12">
            <label class="fw-semibold small">Full Address</label>
            <input type="text" class="form-control" name="address" value="{{ current_user.address or '' }}"
                   placeholder="House/Unit No., Street, Barangay, City/Municipality, Province"/>
          </div>
          {% if current_user.is_farmer %}
          <div class="col-12">
            <label class="fw-semibold small">Farm Bio / Description</label>
            <textarea class="form-control" name="bio" rows="3" placeholder="Tell buyers about your farm, specialties, growing methods...">{{ current_user.bio or '' }}</textarea>
          </div>
          {% endif %}
        </div>
        <button type="submit" class="btn btn-success w-100 btn-lg fw-semibold mt-4">
          <i class="fas fa-save me-2"></i>Save Profile
        </button>
      </form>
    </div>
  </div>
</div>

<script>
function previewAvatar(input) {
  if (input.files && input.files[0]) {
    document.getElementById('profileImageInput').files = input.files;
    const reader = new FileReader();
    reader.onload = e => { document.getElementById('avatarPreview').src = e.target.result; };
    reader.readAsDataURL(input.files[0]);
  }
}
</script>
{% endblock %}